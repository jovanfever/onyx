!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="dist/",n(n.s=0)}([function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t);var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.events_queue={}}var t,n,o;return t=e,(n=[{key:"on",value:function(e,t){return Array.isArray(this.events_queue[e])||(this.events_queue[e]=[]),this.events_queue[e].push(t),this}},{key:"trigger",value:function(e,t){for(var n=this.events_queue[e]||[],i=0;i<n.length;i++)n[i].apply(this,t);return this}},{key:"clearAll",value:function(){return this.events_queue={},this}}])&&i(t.prototype,n),o&&i(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=$.extend({loadOnScroll:!1,maxHeight:500,title:"Image Gallery",close_text:"Close",ok_text:"Add",selectAll_text:"Select all",deselectAll_text:"Deselect all",noImageSelected_msg:"One image at least must be selected."},t),this.event=new o,this.template=this.getModalTemplate(),this.$modal=$(this.template).hide(),this.select_class="selected-img",this.addStyleToDom(),this.setOptions(),this.attachEvents()}var t,n,i;return t=e,(n=[{key:"setOptions",value:function(){this.$modal.find(".modal-body").css("max-height",this.options.maxHeight),this.$modal.find(".modal-title").html(this.options.title),this.$modal.find("#close").html(this.options.close_text),this.$modal.find("#save").html(this.options.ok_text),this.$modal.find("#select-all").html(this.options.selectAll_text),this.$modal.find("#deselect-all").html(this.options.deselectAll_text)}},{key:"addImages",value:function(e,t){var n=this.createImages(e,t);this.$modal.find(".images-list").find(".img-item").length?this.$modal.find(".images-list").append(n):this.$modal.find(".images-list").html(n)}},{key:"createImages",value:function(e,t){for(var n=this,i=[],o=0;o<e.length;o++){var a=$('<img class="img-thumbnail sng-image" title="'+e[o].title+'" data-page="'+t+'"/>');a.get(0).onload=function(){$(this).siblings(".loading").hide(),$(this).click((function(e){$(this).toggleClass(n.select_class)}))},a.attr("src",e[o].src);var l=$('<div class="col-md-4 mb-4 img-item"><i class="fa fa-check"></i><span class="loading"><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></span></div>');l.prepend(a),i.push(l)}return i}},{key:"showError",value:function(e,t){var n=this.$modal.find(".message");n.html('<span class="alert alert-danger">'+e+"</span>"),t||setTimeout((function(){n.html("")}),5e3)}},{key:"showLoading",value:function(){this.$modal.find(".modal-footer .loading").show()}},{key:"hideLoading",value:function(){this.$modal.find(".modal-footer .loading").hide()}},{key:"attachEvents",value:function(){var e=this,t=this.$modal,n=t.find(".modal-body");t.find("button#save").click((function(n){var i=t.find(".img-item img."+e.select_class);i.length?(e.event.trigger("beforeSave",[e]),i.each((function(t,n){e.event.trigger("save",[e,$(this)]),$(this).removeClass(e.select_class)})),e.event.trigger("afterSave",[this])):e.showError(e.options.noImageSelected_msg)})),t.on("hidden.bs.modal",(function(){e.event.trigger("close")})),t.find("button#select-all").click((function(n){t.find("img").addClass(e.select_class)})),t.find("button#deselect-all").click((function(n){t.find("img").removeClass(e.select_class)})),t.find("button#close").click((function(t){e.event.trigger("close")})),t.find("button#mdClose").click((function(t){e.event.trigger("close")})),n.scroll((function(){var i=t.find(".images-list");n.scrollTop()+n.height()>=i.height()-100&&e.event.trigger("scrollBottom",[e])}))}},{key:"open",value:function(){this.addModalToDom(),this.showModal()}},{key:"clearContent",value:function(){this.$modal.find(".images-list").html("")}},{key:"hideModal",value:function(){this.$modal.hide()}},{key:"showModal",value:function(){this.$modal.show()}},{key:"addModalToDom",value:function(){this.$modal.appendTo("body")}},{key:"imagesContainerHasScroll",value:function(){var e=this.$modal.find(".modal-body"),t=e.find(".images-list");return parseInt(t.height())>parseInt(e.height())}},{key:"getModalTemplate",value:function(){return parseInt($.fn.modal.Constructor.VERSION),'<div class="modal summernote-gallery" id="my-modal" tabindex="-1" role="dialog"><div class="modal-dialog modal-xl"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="galleryModalLabel">[gallery title]</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div class="row images-list"></div></div><div class="modal-footer"><span style="display: none;position: absolute;left: 10px;bottom: 10px;" class="loading" ><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></span ><button type="button" id="close" class="btn btn-warning" data-dismiss="modal">[Close]</button><button type="button" id="save" class="btn btn-primary">[Add]</button><span class="message" ></span ></div></div></div></div>'}},{key:"addStyleToDom",value:function(){this.$css=$("<style>.img-item{position : relative;}.img-item .fa-check{position : absolute;top : -10px;right : 5px;font-size: 30px;color: #337AB7;}.img-item .sng-image{}.img-item .loading{position: absolute;margin: auto;top: -20px;bottom: 0;display: block;left: 0;right: 0;width: 60px;height: 42px;text-align: center;}.modal.summernote-gallery .message{display: block;padding: 30px 0 20px 0;}.modal.summernote-gallery .message:empty{display: block;padding: 0px!important;}.modal.summernote-gallery .modal-body{overflow: scroll;}.img-item .fa-check{display : none;}.img-item ."+this.select_class+" + .fa-check{display : block;}."+this.select_class+"{background-color: #5CB85C;}</style>"),this.$css.appendTo("body")}}])&&a(t.prototype,n),i&&a(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=$.extend({url:null,data:[],responseDataKey:"data",nextPageKey:"links.next"},t),this.init()}var t,n,i;return t=e,(n=[{key:"init",value:function(e){this.current_page=0,this.is_fetching_locked=!1,this.event=new o,this.fetch_url=this.options.url,this.fetch_type=this.options.data.length?"data":this.fetch_url?"url":null}},{key:"setNextFetch",value:function(e){e.next_link&&e.data.length?this.fetch_url=e.next_link:this.lockFetching()}},{key:"lockFetching",value:function(){this.is_fetching_locked=!0}},{key:"unlockFetching",value:function(){this.is_fetching_locked=!1}},{key:"getObjectKeyByString",value:function(e,t,n){var i=t.split(".").reduce((function(e,t){return e?e[t]:{}}),e);return void 0===n&&(n=i),i&&!$.isEmptyObject(i)?i:n}},{key:"parseResponse",value:function(e){return{data:this.getObjectKeyByString(e,this.options.responseDataKey,[]),next_link:this.getObjectKeyByString(e,this.options.nextPageKey,null)}}},{key:"fetchData",value:function(){var e=this;if("data"==this.fetch_type)this.event.trigger("beforeFetch"),this.event.trigger("fetch",[e.options.data]),this.event.trigger("afterFetch");else if("url"==this.fetch_type){if(this.is_fetching_locked)return;var t=e.fetch_url;this.event.trigger("beforeFetch"),this.lockFetching(),$.ajax({url:t,beforeSend:function(e){e.request_link=t}}).always((function(){e.unlockFetching()})).done((function(t,n,i){var o=e.parseResponse(t);e.current_page++,e.setNextFetch(o),e.event.trigger("fetch",[o.data,e.current_page,i.request_link,o.next_link])})).fail((function(){e.event.trigger("error",["problem loading from "+t])})).always((function(){e.event.trigger("afterFetch")}))}else e.event.trigger("error",["options 'data' or 'url' must be set"])}},{key:"fetchNext",value:function(){"url"==this.fetch_type&&this.fetchData()}}])&&s(t.prototype,n),i&&s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=$.extend({name:"summernoteGallery",buttonLabel:'<i class="fa fa-file-image-o"></i> Gallery',tooltip:"summernote gallery"},t),this.plugin_default_options={}}var t,n,i;return t=e,(n=[{key:"recoverEditorFocus",value:function(){var e=$(this.editor).data("last_focused_element");if(void 0!==e){var t=this.editable,n=document.createRange(),i=window.getSelection(),o=e.length;n.setStart(e,o),n.collapse(!0),i.removeAllRanges(),i.addRange(n),t.focus()}}},{key:"saveLastFocusedElement",value:function(){var e=window.getSelection().focusNode,t=$(this.editable).get(0);$.contains(t,e)&&$(this.editor).data("last_focused_element",e)}},{key:"attachEditorEvents",value:function(){var e=this;$(this.editable).on("keypress, mousemove",(function(){e.saveLastFocusedElement()}))}},{key:"initGallery",value:function(e){this.context=e,this.editor=this.context.layoutInfo.note,this.editable=this.context.layoutInfo.editable,this.plugin_options=$.extend(this.plugin_default_options,this.context.options[this.options.name]||{}),this.modal=new l(this.plugin_options.modal),this.data_manager=new r(this.plugin_options.source),this.attachModalEvents(),this.attachEditorEvents()}},{key:"attachModalEvents",value:function(){var e=this;this.modal.event.on("beforeSave",(function(t){e.recoverEditorFocus()})),this.modal.event.on("save",(function(t,n){e.context.invoke("editor.pasteHTML",'<img src="'+n.attr("src")+'" alt="'+(n.attr("alt")||"")+'" />')})),this.modal.event.on("scrollBottom",(function(t){e.modal.options.loadOnScroll&&e.data_manager.fetchNext()})),this.modal.event.on("close",(function(t){e.data_manager.init(),e.modal.clearContent(),e.modal.hideModal()})),this.modal.event.on("afterSave",(function(t){e.data_manager.init(),e.modal.clearContent(),e.modal.hideModal()}))}},{key:"createButton",value:function(){var e=this;return $.summernote.ui.button({className:"w-100",contents:this.options.buttonLabel,tooltip:this.options.tooltip,click:function(){e.openGallery()}}).render()}},{key:"attachDataEvents",value:function(){var e=this;this.data_manager.event.on("beforeFetch",(function(){e.modal.showLoading()})).on("fetch",(function(t,n,i){e.modal.addImages(t,n),setTimeout((function(){e.modal.options.loadOnScroll&&!e.modal.imagesContainerHasScroll()&&e.data_manager.fetchNext()}),2e3)})).on("afterFetch",(function(){e.modal.hideLoading()})).on("error",(function(t){e.modal.showError(t,!0)}))}},{key:"openGallery",value:function(){console.log("Start Open Gallery"),this.attachDataEvents(),this.data_manager.fetchData(),this.modal.open()}}])&&c(t.prototype,n),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var f=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.summernote_gallery=new u(t)}var t,n,i;return t=e,(n=[{key:"getPlugin",value:function(){var e={},t=this,n=this.summernote_gallery.options;return e[n.name]=function(e){var i=(e.options[n.name]||{}).buttonLabel||t.summernote_gallery.options.buttonLabel;t.summernote_gallery.options.buttonLabel=i,e.memo("button."+n.name,t.createButton()),this.events={"summernote.keyup":function(e,n){t.summernote_gallery.saveLastFocusedElement()}},this.initialize=function(){t.summernote_gallery.initGallery(e)}},e}},{key:"createButton",value:function(){return this.summernote_gallery.createButton()}}])&&d(t.prototype,n),i&&d(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}());$.extend($.summernote.plugins,f.getPlugin())}]);
//# sourceMappingURL=summernote-gallery.min.js.map