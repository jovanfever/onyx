!function(t){var e={};function n(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="dist/",n(n.s=0)}([function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}n.r(e);var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.events_queue={}}var e,n,a;return e=t,(n=[{key:"on",value:function(t,e){return Array.isArray(this.events_queue[t])||(this.events_queue[t]=[]),this.events_queue[t].push(e),this}},{key:"trigger",value:function(t,e){for(var n=this.events_queue[t]||[],i=0;i<n.length;i++)n[i].apply(this,e);return this}},{key:"clearAll",value:function(){return this.events_queue={},this}}])&&i(e.prototype,n),a&&i(e,a),t}();function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=$.extend({loadOnScroll:!1,maxHeight:500,title:"summernote image gallery",close_text:"Close",ok_text:"Add",selectAll_text:"Select all",deselectAll_text:"Deselect all",noImageSelected_msg:"One image at least must be selected."},e),this.event=new a,this.template=this.getModalTemplate(),this.$modal=$(this.template).hide(),this.select_class="selected-img",this.addStyleToDom(),this.setOptions(),this.attachEvents()}var e,n,i;return e=t,(n=[{key:"setOptions",value:function(){this.$modal.find(".modal-body").css("max-height",this.options.maxHeight),this.$modal.find(".modal-title").html(this.options.title),this.$modal.find("#close").html(this.options.close_text),this.$modal.find("#save").html(this.options.ok_text),this.$modal.find("#select-all").html(this.options.selectAll_text),this.$modal.find("#deselect-all").html(this.options.deselectAll_text)}},{key:"addImages",value:function(t,e){var n=this.createImages(t,e);this.$modal.find(".images-list").find(".img-item").length?this.$modal.find(".images-list").append(n):this.$modal.find(".images-list").html(n)}},{key:"createImages",value:function(t,e){for(var n=$("<div "+(e?'class="page-content" data-page"'+e+'"':"")+"></div>"),i=this,a=0;a<t.length;a++){var o=$('<img class="col-md-12 thumbnail" title="'+t[a].title+'"/>');o.get(0).onload=function(){$(this).siblings(".loading").hide(),$(this).click((function(t){$(this).toggleClass(i.select_class)}))},o.attr("src",t[a].src);var s=$('<div class="col-md-2 img-item"><i class="fa fa-check"></i><span class="loading"><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></span></div>');s.prepend(o),n.append(s)}return n}},{key:"showError",value:function(t,e){var n=this.$modal.find(".message");n.html('<span class="alert alert-danger">'+t+"</span>"),e||setTimeout((function(){n.html("")}),5e3)}},{key:"showLoading",value:function(){this.$modal.find(".modal-footer .loading").show()}},{key:"hideLoading",value:function(){this.$modal.find(".modal-footer .loading").hide()}},{key:"attachEvents",value:function(){var t=this,e=this.$modal,n=e.find(".modal-body");e.find("button#save").click((function(n){var i=e.find(".img-item img."+t.select_class);i.length?(e.modal("hide"),t.event.trigger("beforeSave",[t]),i.each((function(e,n){t.event.trigger("save",[t,$(this)]),$(this).removeClass(t.select_class)})),t.event.trigger("afterSave",[this])):t.showError(t.options.noImageSelected_msg)})),e.on("hidden.bs.modal",(function(){t.event.trigger("close")})),e.find("button#select-all").click((function(n){e.find("img").addClass(t.select_class)})),e.find("button#deselect-all").click((function(n){e.find("img").removeClass(t.select_class)})),n.scroll((function(){var i=e.find(".images-list");n.scrollTop()+n.height()>=i.height()-100&&t.event.trigger("scrollBottom",[t])}))}},{key:"open",value:function(){this.$modal.modal()}},{key:"clearContent",value:function(){this.$modal.find(".images-list").html("")}},{key:"imagesContainerHasScroll",value:function(){var t=this.$modal.find(".modal-body"),e=t.find(".images-list");return t.height()!=e.height()}},{key:"getModalTemplate",value:function(){var t=['<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>','<h4 class="modal-title">[gallery title]</h4>'];return'<div class="modal summernote-gallery fade" tabindex="-1" role="dialog"><div class="modal-lg modal-dialog "><div class="modal-content"><div class="modal-header">'+(3==parseInt($.fn.modal.Constructor.VERSION)?t.join(""):t.reverse().join(""))+'</div><div class="modal-body"><div class="row images-list"></div></div><div class="modal-footer"><span style="display: none;position: absolute;left: 10px;bottom: 10px;" class="loading" ><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></span ><span style="display: inline-block; margin-right: 50px;"><button type="button" id="deselect-all" class="btn btn-default">[Deselect-all]</button><button type="button" id="select-all" class="btn btn-default">[select-all]</button></span ><button type="button" id="close" class="btn btn-default" data-dismiss="modal">[Close]</button><button type="button" id="save" class="btn btn-primary">[Add]</button><span class="message" ></span ></div></div></div></div>'}},{key:"addStyleToDom",value:function(){this.$css=$("<style>.img-item{position : relative;}.img-item .fa-check{position : absolute;top : -10px;right : 5px;font-size: 30px;color: #337AB7;}.img-item .thumbnail{min-height : 119.66px;}.img-item .loading{position: absolute;margin: auto;top: -20px;bottom: 0;display: block;left: 0;right: 0;width: 60px;height: 42px;text-align: center;}.modal.summernote-gallery .message{display: block;padding: 30px 0 20px 0;}.modal.summernote-gallery .message:empty{display: block;padding: 0px!important;}.modal.summernote-gallery .modal-body{overflow: scroll;}.img-item .fa-check{display : none;}.img-item ."+this.select_class+" + .fa-check{display : block;}."+this.select_class+"{background-color: #5CB85C;}</style>"),this.$css.appendTo("body")}}])&&o(e.prototype,n),i&&o(e,i),t}();function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=$.extend({url:null,data:[],responseDataKey:"data",nextPageKey:"links.next"},e),this.init()}var e,n,i;return e=t,(n=[{key:"init",value:function(t){this.current_page=0,this.is_fetching_locked=!1,this.event=new a,this.fetch_url=this.options.url,this.fetch_type=this.options.data.length?"data":this.fetch_url?"url":null}},{key:"setNextFetch",value:function(t){t.next_link&&t.data.length?this.fetch_url=t.next_link:this.lockFetching()}},{key:"lockFetching",value:function(){this.is_fetching_locked=!0}},{key:"unlockFetching",value:function(){this.is_fetching_locked=!1}},{key:"getObjectKeyByString",value:function(t,e,n){var i=e.split(".").reduce((function(t,e){return t?t[e]:{}}),t);return void 0===n&&(n=i),i&&!$.isEmptyObject(i)?i:n}},{key:"parseResponse",value:function(t){return{data:this.getObjectKeyByString(t,this.options.responseDataKey,[]),next_link:this.getObjectKeyByString(t,this.options.nextPageKey,null)}}},{key:"fetchData",value:function(){var t=this;if("data"==this.fetch_type)this.event.trigger("beforeFetch"),this.event.trigger("fetch",[t.options.data]),this.event.trigger("afterFetch");else if("url"==this.fetch_type){if(this.is_fetching_locked)return;var e=t.fetch_url;this.event.trigger("beforeFetch"),this.lockFetching(),$.ajax({url:e,beforeSend:function(t){t.request_link=e}}).always((function(){t.unlockFetching()})).done((function(e,n,i){var a=t.parseResponse(e);t.current_page++,t.setNextFetch(a),t.event.trigger("fetch",[a.data,t.current_page,i.request_link,a.next_link])})).fail((function(){t.event.trigger("error",["problem loading from "+e])})).always((function(){t.event.trigger("afterFetch")}))}else t.event.trigger("error",["options 'data' or 'url' must be set"])}},{key:"fetchNext",value:function(){"url"==this.fetch_type&&this.fetchData()}}])&&l(e.prototype,n),i&&l(e,i),t}();function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=$.extend({name:"summernote-gallery",button_label:'<i class="fa fa-file-image-o"></i>',tooltip:"summernote gallery"},e),this.event=new a,this.plugin_default_options={}}var e,n,i;return e=t,(n=[{key:"recoverEditorFocus",value:function(){var t=$(this.editor).data("last_focused_element");if(void 0!==t){var e=this.editable,n=document.createRange(),i=window.getSelection(),a=t.length;n.setStart(t,a),n.collapse(!0),i.removeAllRanges(),i.addRange(n),e.focus()}}},{key:"saveLastFocusedElement",value:function(){var t=window.getSelection().focusNode,e=$(this.editable).get(0);$.contains(e,t)&&$(this.editor).data("last_focused_element",t)}},{key:"attachEditorEvents",value:function(){var t=this;$(this.editable).on("keypress, mousemove",(function(){t.saveLastFocusedElement()}))}},{key:"initGallery",value:function(t){this.context=t,this.editor=this.context.layoutInfo.note,this.editable=this.context.layoutInfo.editable,this.plugin_options=$.extend(this.plugin_default_options,this.context.options[this.options.name]||{}),this.modal=new s(this.plugin_options.modal),this.data_manager=new r(this.plugin_options.source),this.attachModalEvents(),this.attachEditorEvents()}},{key:"attachModalEvents",value:function(){var t=this;this.modal.event.on("beforeSave",(function(e){t.recoverEditorFocus()})),this.modal.event.on("save",(function(e,n){t.context.invoke("editor.pasteHTML",'<img src="'+n.attr("src")+'" alt="'+(n.attr("alt")||"")+'" />')})),this.modal.event.on("scrollBottom",(function(e){t.modal.options.loadOnScroll&&t.data_manager.fetchNext()})),this.modal.event.on("close",(function(e){t.data_manager.init(),t.modal.clearContent()}))}},{key:"createButton",value:function(){var t=this;return $.summernote.ui.button({contents:this.options.button_label,tooltip:this.options.tooltip,click:function(){t.openGallery()}}).render()}},{key:"attachDataEvents",value:function(){var t=this;this.data_manager.event.on("beforeFetch",(function(){t.modal.showLoading()})).on("fetch",(function(e,n,i){t.modal.addImages(e,n),setTimeout((function(){t.modal.options.loadOnScroll&&!t.modal.imagesContainerHasScroll()&&t.data_manager.fetchNext()}),2e3)})).on("afterFetch",(function(){t.modal.hideLoading()})).on("error",(function(e){t.modal.showError(e,!0)}))}},{key:"openGallery",value:function(){this.attachDataEvents(),this.data_manager.fetchData(),this.modal.open()}}])&&c(e.prototype,n),i&&c(e,i),t}();function d(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var h=new(function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=e}var e,n,i;return e=t,(n=[{key:"getPlugin",value:function(){var t={},e=this;return t[this.options.name]=function(t){var n=new u(e.options);t.memo("button."+n.options.name,n.createButton()),this.events={"summernote.keyup":function(t,e){n.saveLastFocusedElement()}},this.initialize=function(){n.initGallery(t)}},t}}])&&d(e.prototype,n),i&&d(e,i),t}())({name:"gallery",tooltip:"Gallery"});$.extend($.summernote.plugins,h.getPlugin())}]);
//# sourceMappingURL=summernote-gallery.min.js.map